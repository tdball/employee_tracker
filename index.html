<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/theme.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBotE4PbLbkOzdfAdfQVcV3ih-c_CHlS9I">
    </script>
    <script type='text/javascript' src="assets/js/data.js"></script>
    <script type='text/javascript' src="assets/js/mapSwitch.js"></script>
    <script type='text/javascript' src="assets/js/mapDataValidation.js"></script>
</head>
<body>
    <div class="fullscreen">
        <div class="map-area">
            <div class="map" id="gmap"></div>
            <div class="map" style='display:none;' id="omap"></div>
        </div>
        <div class="map-controls">
            <button class="map-toggle" type="button" id="mapToggle" onclick="mapSwitch.toggleMaps()">Switch To OpenStreetMaps</button>
        </div>
    </div>
<script>
    let mapSwitch = new MapSwitch()
    let defaultZoom = 10
    // Verify page content has loaded.
    // document.addEventListener("DOMContentLoaded", function(event) {
        let gmap = new google.maps.Map(document.getElementById('gmap'), {
            center: {lat: userData[0].latitude, lng: userData[0].longitude},
            zoom: defaultZoom
        })
        let omap = L.map('omap', {
            center: [userData[0].latitude, userData[0].longitude],
            zoom: defaultZoom
        })

        // Binding the leaflet object to a property on the omap element. For access outside this scope.
        // Needed for map resizing currently. Alternate solution may be to use z-levels to handle the issue
        // with default sizings of the leaflet generated map. Google doesn't exhibit this issue currently.
        document.getElementById('omap').leaflet = omap

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 8,
        id: 'mapbox.streets',
        accessToken: 'pk.eyJ1IjoidGRiYWxsIiwiYSI6ImNqZGQ2ZXN3cTBveTAzM3M0Y2hjNGdicWYifQ.8ZyvzI_lpo_YINCzf0KKrg'
        }).addTo(omap);


        // lets plot the userData across both maps
        for(let entry of userData) {
            if(validateCoordinates(entry)) {

                let gMarker = new google.maps.Marker({
                    position: {lat: entry.latitude, lng: entry.longitude},
                    map: gmap,
                    icon: entry.logo,
                })
                let popup = new google.maps.InfoWindow({
                    content: entry.name
                })
                gMarker.addListener('click', function() {
                    popup.open(gmap, gMarker)
                })

                let oMarker = L.marker([entry.latitude, entry.longitude]).addTo(omap)

                let oPopup = oMarker.bindPopup(entry.name)


                oMarker.on('click', function() {
                    oPopup.openPopup()
                })

            }
        }
    // });
</script>
</body>
</html>